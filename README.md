# Описание
Здесь представлены реализации алгоритмов для сравнения повторяемости устойчивых точек (main_repeatability.py) и оценки качества сопоставления изображений (main_quality.py) в задаче optical-to-SAR сопоставления, описанные в [1], а также собранный нами датасет из 100 выровненных пар optical-SAR изображений.
Подробное описание датасета представлено в dataset/README.md

# Алгоритм для сравнения повторяемости устойчивых точек
Программа вычисляет среднее количество и долю правильных сопоставлений. Правильным сопоставлением считаем пару точек, расстояние между которыми меньше порога θ (полученного на входе алгоритма). Предусмотрено два режима. Первый – общий случай. Второй – предполагаем, что изображения уже грубо выровнены, т.о. поиск устойчивых точек на втором изображении происходит в некоторой окрестности их ожидаемого положения. Подробнее алгоритм описан в [1].

Вход:
1) директория с заранее вычисленными координатами устойчивых точек (см. "Формат устойчивых точек") ('kps_dir', позиционный параметр)
2) порог сопоставления ('theta', type=float, позиционный параметр)
3) радиус окрестности, в которой искать сопоставление ('--search_raidus', '-r', type=int, default=inf)

Требуемые библиотеки:
1) numpy
2) tqdm

Пример запуска в первом режиме:

python main_repeatability.py .\keypoints\kps_sift_optim 4

Пример запуска во втором режиме:

python main_repeatability.py .\keypoints\kps_sift_optim 4 -r 10

# Формат устойчивых точек
Примеры файлов с устойчивыми точками лежат в папке ./keypoints.
Файлы с координатами устойчивых точек должны быть в формате json. Путь к файлам предполагается в формате ./{opt или sar}/<имя изображения>.json.
Json файлы представляют собой список словарей следующего вида:

{x: <x координата точки>,
y: <y координата точки>}

# Алгоритм вычисления качества сопоставления изображений
Программа вычисляет долю правильных сопоставлений изображений по заранее найденным сопоставлениям устойчивых точек. Для этого происходит вычисление геометрического преобразования между изображениями с помощью алгоритма RANSAC. Если каждый угол первого изображения после преобразования сместился на расстояние не более --dists_thr пикселей от ожидаемого положения, то изображения считаются правильно сопоставленными. Подробнее алгоритм описан в [1].

Вход:
1) директория с заранее вычисленными сопоставлениями устойчивых точек (см. "Формат сопоставлений устойчивых точек") ('matches_dir', позиционный параметр)
2) размер изображения в пикселях в виде двух чисел "ширина высота" ('image_size', type=int, позиционный параметр)
3) расстояние в пикселях, при превышении которого RANSAC определяет сопоставление как выбросное ('--ransac_thr', '-r', type=float, default=2)
4) порог успешного сопоставления изображений в пикселях ('--dists_thr', '-t', type=float, default=5)

Требуемые библиотеки:
1) numpy
2) tqdm
3) cv2

Пример запуска:

python main_quality.py .\matches\harris_binning\thr=2 1024 1024

# Формат сопоставлений устойчивых точек
Примеры файлов представлены в ./matches.
Каждая строчка файла, начиная со второй, описывает сопоставление пары точек в виде 4 координат: opt_x, opt_y, sar_x, sar_y (opt_x, opt_y – координаты точки на оптическом изображении; sar_x, sar_y – координаты соответствующей ей точки на SAR изображении).

# Литература
1. В. В. Волков, Е. А. Швец. Повторяемость устойчивых точек в задаче сопоставления оптических и радиолокационных изображений. 
