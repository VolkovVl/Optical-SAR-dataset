# Описание
Здесь представлен датасет из 100 выравненных пар optical-SAR изображений, а также имплементация методов для сравнения алгоритмов сопоставления изображений: метод для оценки повторяемости устойчивых точек (`main_repeatability.py`), метод для оценки точности сопоставления устойчивых точек (`main_matching_accuracy.py`) и метод для оценки точности сопоставления изображений (`main_image_registration_accuracy.py`).
Подробное описание датасета представлено в `dataset/README.md`

# Алгоритм для оценки повторяемости устойчивых точек
Программа `main_repeatability.py` вычисляет среднее количество и долю повторяемых точек. Устойчивая точка считается повторяемой, если на другом изображении существует хотя бы одна точка такая, что расстояние по L2 между ними (после приведения первой точки к системе координат второго изображения) не больше порога `theta`. Предусмотрено две вариации алгоритма: `'all'` -- учитываются все повторяемые точки и `'nearest'` -- учитываются только взаимно ближайшие повторяемые точки.

## Вход:
1) директория с заранее вычисленными координатами устойчивых точек (см. "Формат устойчивых точек") (`'kps_dir', позиционный параметр`)
2) порог сопоставления в пикселях (`'theta', type=float, позиционный параметр`)
3) выбор вариации алгоритма (`'--mode', '-m', type=str, default='all'`)

## Требуемые библиотеки:
1) numpy
2) tqdm

## Примеры запуска:

`python main_repeatability.py .\keypoints\kps_sift 4`

`python main_repeatability.py .\keypoints\kps_sift 4 -m nearest`

## Формат устойчивых точек
Примеры файлов с устойчивыми точками лежат в папке `./keypoints`.
Файлы с координатами устойчивых точек должны быть в формате json. Путь к файлам предполагается в формате `./{opt или sar}/<имя изображения>.json`.
Json файлы представляют собой список словарей следующего вида:

{x: <x координата точки>,
y: <y координата точки>}

# Алгоритм для оценки точности сопоставления устойчивых точек
Программа `main_matching_accuracy.py` для каждой пары изображений вычисляет метрику RMSE. Результатом является среднее значение RMSE по всем парам изображений.

## Вход:
1) директория с заранее найденными сопоставлениями точек (см. "Формат сопоставлений точек") (`'matches_dir', позиционный паарметр`)

## Требуемые библиотеки:
1) numpy

## Пример запуска:

`python main_matching_accuracy.py .\matches\aligned_sift-sift_16_180`

## Формат сопоставлений точек
Примеры файлов с сопоставлениями устойчивых точек лежат в папке `./matches`. Файл представлен в формате `.txt`. Каждая строка, начиная со второй, описывает одно сопоставление и состоит из 4 чисел с `x, y` координатами разделенных табуляцией (`optical_x optical_y sar_x sar_y`). 

# Алгоритм вычисления качества сопоставления изображений
Программа `main_image_registration_accuracy.py` вычисляет долю правильных сопоставлений изображений по заранее найденным матрицам проективного преобразования (из системы координат оптического к радиолокационному). Пара изображений считается успешно сопоставленными, если положение каждого угла оптического изображения после преобразования отличается от положения соответствующего угла SAR изображения не более чем на `dists_thr` пикселей. 

## Вход:
1) директория с заранее вычисленными матрицами проективного преобразования (`'homography_dir', позиционный параметр`)
2) размер изображения в пикселях в виде двух чисел "ширина высота" (используется для определения углов изображения) (`'image_size', '-i', type=int, default=["1024", "1024"]`)
3) порог успешного сопоставления изображений в пикселях (`'--dists_thr', '-t', type=float, default=10`)

## Требуемые библиотеки:
1) numpy

## Примеры запуска:

`python main_image_registration_accuracy.py .\matches\aligned_sift-sift_16_180\homography`

`python main_image_registration_accuracy.py .\matches\aligned_sift-sift_16_180\homography -i 1024 1024 -t 10`
